#
# ISSUE 126 - chore  
#

FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y build-essential vim wget libpam0g-dev libselinux1-dev zlib1g-dev  \
    pkg-config libssl-dev git ca-certificates \ 
    vim && \
    rm -rf /var/lib/apt/lists/*

#
# INSTALL   sudo - 1.9.16p2
#

WORKDIR /opt

RUN wget https://www.sudo.ws/dist/sudo-1.9.9.tar.gz && \
    tar xzf sudo-1.9.9.tar.gz && \
    cd sudo-1.9.9 && \
    ./configure --disable-gcrypt --prefix=/usr && make && make install

#
# CREATE USER 
#
RUN useradd -m -s /bin/bash lpe && \
    echo "lpe:lpe" | chpasswd && \
    usermod -aG sudo lpe

#
# CONFIGURE SUDO 
# 

RUN mkdir /etc/custom && touch /etc/custom/service.conf
RUN echo "lpe ALL=(ALL:ALL) sudoedit /etc/custom/service.conf" >> /etc/sudoers

USER lpe
WORKDIR /home/lpe
CMD ["sleep infinity"]
