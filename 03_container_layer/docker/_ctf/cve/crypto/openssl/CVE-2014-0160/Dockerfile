#
# ISSUE 50 
#

FROM debian:jessie

RUN echo "deb http://archive.debian.org/debian jessie main contrib non-free" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security jessie/updates main contrib non-free" >> /etc/apt/sources.list && \
    echo 'Acquire::Check-Valid-Until "false";' > /etc/apt/apt.conf.d/99no-check-valid && \
    apt-get update

#
# SETUP NGINX WITH OPENSSL
#
RUN apt-get install -y --force-yes nginx openssl && \
    rm -rf /var/lib/apt/lists/*

#
# GEN SSL CERT
#
RUN mkdir -p /etc/nginx/ssl && \
    openssl req -x509 -newkey rsa:2048 \
    -keyout /etc/nginx/ssl/key.pem -out /etc/nginx/ssl/cert.pem \
    -days 365 -nodes -subj "/C=LU/ST=LAB/L=LAB/O=LAB/CN=localhost"

#
# NGINX CONFIGURATION
#
RUN rm /etc/nginx/sites-enabled/default && \
    echo "server { \
    listen 443 ssl; \
    ssl_certificate /etc/nginx/ssl/cert.pem; \
    ssl_certificate_key /etc/nginx/ssl/key.pem; \
    location / { return 200 'LAB OK\\n'; } \
    }" > /etc/nginx/sites-enabled/ssl.conf

EXPOSE 443
#CMD ["nginx", "-g", "daemon off;"]
CMD ["/bin/bash"]