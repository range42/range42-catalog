

<?php
//
// ISSUE 39
//
if (!empty($_FILES)):
    if (!is_uploaded_file($_FILES['file_upload']['tmp_name'])) {
        die('error - not uploaded file');
    }

    $ext = strtolower(pathinfo($_FILES['file_upload']['name'], PATHINFO_EXTENSION));
    if ($ext !== 'pdf') {
        die('error - extension ');
    }

    ///
    ///
    ///

    $new_name = uniqid('', true) . '.pdf';
    $dest = __DIR__ . '/upload/' . $new_name;
    if (!move_uploaded_file($_FILES['file_upload']['tmp_name'], $dest)) {
        die('Error uploading file - move_uploaded_file ');
    }

    // redirect
    header('Location: /web/viewer.html?file=' . rawurlencode('../upload/' . $new_name), true, 302);
    exit;
else:
?>
<!doctype html>
<html>
    <body>
        <form method="post" enctype="multipart/form-data">
            <label>PDF: 
                <input type="file" name="file_upload" accept="application/pdf">
            </label>
            <button type="submit">Upload</button>
        </form>
    </body>
</html>
<?php endif; ?>
